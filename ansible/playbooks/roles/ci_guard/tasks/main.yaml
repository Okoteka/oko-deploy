---
# This role prevents accidental or intentional execution of CI-only playbooks
# from a local machine. It enforces two checks:
#   1) The playbook must run under a trusted system user (e.g. gitlab-runner)
#   2) GitLab CI-specific environment variables must be present

- name: "CI Guard: Fail if required environment variables are missing"
  ansible.builtin.fail:
    msg: "This playbook requires CI environment variable '{{ item }}'"
  loop: "{{ ci_guard_required_env_vars }}"
  when: lookup('env', item) is none or lookup('env', item) | length == 0
  run_once: true
